(self.webpackChunkfunbox_test_task_js=self.webpackChunkfunbox_test_task_js||[]).push([[179],{8508:(e,t,a)=>{"use strict";var n=a(7294),s=a(3935),r=a(9862),l=a(7865),o=a(2948),i=a(3458);const c=(d="AIzaSyAHP1Twa5SARLW8B01KUEOb5jIiaubsIuE",o.Z.setApiKey(d),o.Z.setLanguage("ru"),o.Z.setRegion("ru"),{async getClientGeolocation(){const{coords:e}=await new Promise(((e,t)=>{navigator.geolocation.getCurrentPosition((t=>e(t)),(e=>t(e)))}));return e},async getAddressFromCoords(e,t){try{return(await o.Z.fromLatLng(e,t)).results[0].formatted_address}catch(e){throw new Error("Couldn't retrieve the address using external Google API: "+e)}},async getCoordsFromAddress(e){try{const t=await o.Z.fromAddress(e);return{lat:t.results[0].geometry.location.lat,lng:t.results[0].geometry.location.lng,text:t.results[0].formatted_address}}catch(e){throw new Error("Couldn't retrieve the coordinates using external Google API: "+e)}}});var d;const g=(0,i.WS)((0,i.OI)((({initial:e,destinations:t,replace:a})=>{const[s,r]=(0,n.useState)(e);(0,n.useEffect)((()=>{t.length&&r(t[t.length-1])}),[t]);const[l,o]=(0,n.useState)(null),d=()=>o(null);return n.createElement(i.b6,{defaultZoom:12,center:s},t.map((e=>n.createElement(i.Jx,{key:e.id,draggable:!0,position:{lat:e.lat,lng:e.lng},onClick:()=>(e=>o(e))(e),onDragEnd:t=>(async(e,t)=>{const n={lat:e.latLng.lat(),lng:e.latLng.lng()},s=await c.getAddressFromCoords(n.lat,n.lng);a({id:t,text:s,lat:n.lat,lng:n.lng})})(t,e.id)},l===e?n.createElement(i.nx,{onCloseClick:d},n.createElement("span",null,e.text)):null))),n.createElement(i.aH,{path:t}))}))),m=({destinations:e,replace:t,toggleError:a})=>{const[s,r]=(0,n.useState)(!0),[l,o]=(0,n.useState)({lat:0,lng:0}),i=(0,n.useCallback)((async()=>{try{const e=await c.getClientGeolocation();o({lat:e.latitude,lng:e.longitude}),r(!1)}catch(e){a("Не удалось получить данные о вашем местоположении :(","Пожалуйста, разрешите определение местоположения на этой странице")}}),[]);return(0,n.useEffect)((()=>{i()}),[]),s?n.createElement("section",{className:"App__MapPanel MapPanel_isLoading"}):n.createElement(g,{destinations:e,initial:l,replace:t,googleMapURL:"https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=geometry,drawing,places&key=AIzaSyAHP1Twa5SARLW8B01KUEOb5jIiaubsIuE&region=RU&language=ru",containerElement:n.createElement("section",{className:"MapPanel App__MapPanel"}),loadingElement:n.createElement("div",{style:{height:"100%"}}),mapElement:n.createElement("div",{style:{height:"100%"}})})};var u=a(7835),p=a(1436),E=a(7625);const _=({item:e,remove:t,reorder:a,find:s})=>{const[{isDragging:r},l]=(0,u.useDrag)({item:{type:N.DESTINATION,id:e.id,originalIndex:s(e.id)},collect:e=>({isDragging:e.isDragging()}),end:(e,t)=>{const{id:n,originalIndex:s}=t.getItem();t.didDrop()||a(n,s)}}),[,o]=(0,u.useDrop)({accept:N.DESTINATION,canDrop:()=>!1,hover:t=>{t.id!==e.id&&a(t.id,s(e.id))}}),i=r?"DestList__Item_isDragging":"";return n.createElement("li",{"data-testid":"destination-item",className:"DestList__Item "+i,ref:e=>l(o(e))},n.createElement("span",{className:"DestList__Text"},e.text),n.createElement("button",{"data-testid":"delete-button",className:"DestList__DeleteButton",type:"button",onClick:()=>t(e.id)},n.createElement(E.G,{icon:p.I7k})))},f=({destinations:e,remove:t,reorder:a,find:s})=>{const[,r]=(0,u.useDrop)({accept:N.DESTINATION});return n.createElement("ul",{className:"DestList",ref:r},e.map((e=>n.createElement(_,{key:e.id,item:e,remove:t,reorder:a,find:s}))))},y=({add:e,notifyOnChange:t})=>{const[a,s]=(0,n.useState)("");return n.createElement("section",{className:"DestPanel__Input"},n.createElement("input",{className:"DestPanel__TextField",placeholder:"Введите адрес",name:"region-lookup",autoComplete:"off",value:a,onChange:e=>{s(e.target.value),t(e.target.value)},onKeyDown:n=>{13===n.keyCode&&"ENTER"===n.key.toUpperCase()&&(e(a),s(""),t(""))}}))},h=({destinations:e,add:t,remove:a,reorder:s,find:r,notifyOnChange:l})=>n.createElement("section",{className:"DestPanel App__DestPanel"},n.createElement(y,{add:t,notifyOnChange:l}),n.createElement(f,{destinations:e,remove:a,reorder:s,find:r})),D=({title:e="Упс! Что-то пошло не так :(",message:t,isShown:a=!1,toggle:s})=>{const r=a?"Error_isShown":"";return n.createElement("figure",{className:"Error "+r},n.createElement("figcaption",{className:"Error__Title"},e),n.createElement("p",{"data-testid":"error-message",className:"Error__Message"},t),n.createElement("span",{className:"Error__X-icon",onClick:()=>s("","")},"✖"))};var I=a(4586);const C=()=>{const[e,t]=(0,n.useState)([]),[a,s]=(0,n.useState)(""),[r,l]=(0,n.useState)({title:"",message:""}),o=t=>e.findIndex((e=>e.id===t)),i=(e,t)=>{l({title:e,message:t})};return n.createElement("main",{className:"App","data-testid":"app"},n.createElement(h,{destinations:e,add:async()=>{try{const n=await c.getCoordsFromAddress(a);t([...e,{id:(0,I.Z)(),text:n.text,lat:n.lat,lng:n.lng}])}catch(e){i("По вашему запросу ничего не найдено :(","Пожалуйста, убедитесь в корректности введенного адреса!")}},remove:a=>t(e.filter((e=>e.id!==a))),find:o,reorder:(a,n)=>{const s=o(a),r=[...e];r.splice(s,1),r.splice(n,0,e[s]),t(r)},notifyOnChange:e=>s(e)}),n.createElement(m,{destinations:e,replace:a=>{t(e.map((e=>e.id===a.id?a:e)))},toggleError:i}),n.createElement(D,{title:r.title,message:r.message,isShown:!!r.message,toggle:i}))},N={DESTINATION:"destination"},A=()=>n.createElement(r.W,{backend:l.PD},n.createElement(C,null));s.render(n.createElement(A,null),document.getElementById("root"))}},0,[[8508,303,216]]]);